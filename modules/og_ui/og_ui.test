<?php
// $Id$

/**
 * Test the organic groups UI functions.
 */
class OgUiSubscriptionUnitTest extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Users subscription',
      'description' => 'Test user subscription.',
      'group' => 'Organic groups',
    );
  }

  function setUp() {
    parent::setUp('og', 'og_ui');
    $web_admin = $this->drupalCreateUser(array('administer content types'));
    $this->drupalLogin($web_admin);
    $this->web_admin = $web_admin->uid;
        
    // Create a group content type.
    $this->drupalCreateContentType(array('type' => 'group', 'og_content_type_usage' => 'group'));        

    
    // Create a "open" group node.
    $group_open = $this->drupalCreateNode(array('type' => 'group'));
    $this->group_open = $group_open->nid;
    
    $group_moderated = $this->drupalCreateNode(array('type' => 'group'));
    $this->group_moderated = $group_moderated->nid;
    
    $group_invite = $this->drupalCreateNode(array('type' => 'group'));
    $this->group_invite = $group_invite->nid;
    
    $group_closed = $this->drupalCreateNode(array('type' => 'group'));
    $this->group_closed = $group_closed->nid;    
  }
  
  
  function testUserSubscription() {
    // Login web user.
    $web_user = $this->drupalCreateUser(array('access content'));
    $this->drupalLogin($web_user);        
    $this->ogOpenGroup();
  }
  
  
  function ogOpenGroup() {
    // Subscribe to "open" group.
    $this->drupalGet('og/subscribe/'. $group_open->nid);
    $this->assertText(t('You are now a member of'), t('User subscribed to "open" group.'));
  }
  
  function ogModeratedGroup() {
    // Subscribe to "moderated" group.
    $this->drupalGet('og/subscribe/'. $group_moderated->nid);    
  }
  
  function ogInviteGroup() {
    // Subscribe to "invite" group.
    $this->drupalGet('og/subscribe/'. $group_invite->nid);     
  }
  
  function ogClosedGroup() {
    // Subscribe to "closed" group.
    $this->drupalGet('og/subscribe/'. $group_closed->nid);    
  } 
}