<?php
// $Id$

/**
 * Test the organic groups content handeling.
 */
class OgTypeTest extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Organic groups content types',
      'description' => 'Test the organic groups group node and group post creation.',
      'group' => 'Organic groups',
    );
  }

  function setUp() {
    parent::setUp('og');
  }


  function testOgType() {
    $admin_user = $this->drupalCreateUser(array('bypass node access', 'administer content types'));
    $this->drupalLogin($admin_user);

    $this->drupalGet('admin/structure/types/add');

    // Assert OG default types exist.
    $this->assertText(t('Group node'), t('Group node option was found.'));
    $this->assertText(t('group post'), t('Group post option was found.'));
    $this->assertText(t('May not be posted into a group'), t('Omitted option was found.'));

    // Create group content type.
    $group = $this->drupalCreateContentType(array('og_content_type_usage' => 'group'));

    // Create post content type.
    $group_post = $this->drupalCreateContentType(array('og_content_type_usage' => 'group post'));

    $this->assertTrue(og_is_group_post_type($group_post->type), t('Content type is group post.'));

    // Assert group post fields were added to the content type.
    $this->drupalGet('node/add/' . $group_post->type);
    $this->assertText(t('Groups audience'), t('Groups audience field was found.'));
  }
}